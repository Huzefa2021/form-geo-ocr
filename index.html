<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>MCGM | Abandoned Vehicles – Marshal Upload</title>
  <link rel="icon" href="favicon.ico">
  <link rel="preconnect" href="https://cdn.jsdelivr.net" />
  <link rel="preconnect" href="https://unpkg.com" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

  <!-- Sticky Header -->
  <header class="app-header">
    <div class="brand">
      <img class="bmc-logo" src="https://www.mcgm.gov.in/com.mcgm.newframework/images/logo_V1.png" alt="MCGM" />
      <div class="brand-text">
        <div class="title">Municipal Corporation of Greater Mumbai</div>
        <div class="subtitle">Abandoned Vehicles – Identification &amp; Pre-Notice (Marshal Upload)</div>
      </div>
    </div>

    <div class="toolbar">
      <div class="select-wrap">
        <label for="ocrMode">OCR Mode:</label>
        <select id="ocrMode" title="Choose OCR language mode">
          <option value="auto">Auto</option>
          <option value="eng">ENG</option>
          <option value="indic">ENG+Indic</option>
        </select>
      </div>
      <button id="btnReset" class="btn ghost">Reset</button>
      <img class="cres-logo" src="data/Crescendo Logo.png" alt="Crescendo IT Solutions" />
    </div>
  </header>

  <!-- Chips + progress -->
  <div class="top-rail">
    <ul class="milestones">
      <li class="chip" data-i="0">Upload</li>
      <li class="chip" data-i="1">OCR</li>
      <li class="chip" data-i="2">Parse</li>
      <li class="chip" data-i="3">GeoJSON</li>
      <li class="chip" data-i="4">Review</li>
      <li class="chip" data-i="5">Redirect</li>
    </ul>
    <div class="progress"><span id="bar"></span></div>
    <div class="cdn-pill" id="cdnPill">CDN: checking…</div>
  </div>

  <!-- Breadcrumbs -->
  <nav class="breadcrumbs">
    <a href="#">Home</a> › <a href="#">Abandoned Vehicles</a> › <span>Marshal Upload</span>
  </nav>

  <!-- Main content -->
  <main class="container">
    <section class="grid">
      <!-- Left column -->
      <div>
        <div class="card" id="dropCard">
          <h3>Upload Photo</h3>
          <div id="drop" class="dropzone" tabindex="0">
            <div class="dz-inner">
              <strong>Tap to choose image</strong>
              <div>or drag &amp; drop (JPG/PNG from GPS Map Camera)</div>
            </div>
            <input id="file" type="file" accept="image/*" capture="environment" />
          </div>
        </div>

        <div class="card hidden" id="originalCard">
          <h3>Original Photo (25%)</h3>
          <div class="img-wrap center">
            <img id="originalImg" alt="original preview" />
          </div>
        </div>

        <div class="card hidden" id="overlayCard">
          <h3>Cropped Overlay (GPS text)</h3>
          <div id="overlayWrap" class="img-wrap overlay center">
            <img id="overlayImg" alt="overlay preview" />
            <div id="overlayScanner" class="scanner"></div>
          </div>
        </div>
      </div>

      <!-- Right column -->
      <div>
        <div class="card">
          <h3>Results</h3>
          <div id="results"><!-- rows inserted by JS --></div>
          <div id="resultsNote" class="note">Results will be populated post processing.</div>
        </div>
      </div>
    </section>

    <div class="statusbar">
      <span id="status" class="status">Initializing…</span>
      <span id="stageTimes" class="times">
        Upload — 0.0s • OCR — 0.0s • Parse — 0.0s • GeoJSON — 0.0s • Review — 0.0s • Redirect — 0.0s
      </span>
    </div>

    <div id="redirectNote" class="redirect hidden"></div>
  </main>

  <!-- Sticky Footer -->
  <footer class="app-footer">
    <div class="footer-left">
      <strong>Developed by</strong> Crescendo Innovative Solutions LLP ·
      <strong>Admin:</strong> Huzefa Fakhruddin —
      <a href="mailto:Care@crescendoits.com">Care@crescendoits.com</a>
      · © 2025 Municipal Corporation of Greater Mumbai (MCGM) —
      <a href="https://www.mcgm.gov.in" target="_blank" rel="noopener">www.mcgm.gov.in</a>
    </div>
    <div class="footer-right">
      Build: <span id="appVersion">—</span>
    </div>
  </footer>

  <!-- Generic Modal -->
  <div id="modalBackdrop" class="modal-backdrop" style="display:none;">
    <div class="modal">
      <h3 id="modalTitle">Notice</h3>
      <div id="modalBody" class="modal-body">—</div>
      <div class="modal-actions">
        <button id="modalReset" class="btn">Reset Session</button>
        <button id="modalCancel" class="btn ghost">Close</button>
      </div>
    </div>
  </div>

  <!-- Timeout Modal -->
  <div id="timeoutBackdrop" class="modal-backdrop" style="display:none;">
    <div class="modal">
      <h3 id="timeoutTitle">Stage Timed Out</h3>
      <div class="modal-body">
        A stage exceeded the maximum allowed time.<br/>
        <strong>Reason:</strong> network slowness, large image, or blocked resources.
      </div>
      <div class="modal-actions">
        <button id="timeoutRetry" class="btn">Retry</button>
        <button id="timeoutClose" class="btn ghost">Close</button>
      </div>
    </div>
  </div>

  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6.5.0/turf.min.js"></script>

  <!-- Keep this line so OpenCV preprocessing is used when available -->
  <script async src="https://docs.opencv.org/4.x/opencv.js"
          onload="window.__cvLoaded=true"
          onerror="window.__cvLoaded=false"></script>

  <!-- App -->
  <script src="app.js"></script>
</body>
</html>
