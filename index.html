<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>MCGM | Abandoned Vehicles – Marshal Upload Portal</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

    <!-- Inline favicon (prevents 404s on static hosts) -->
    <link
      rel="icon"
      type="image/svg+xml"
      href='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0" stop-color="%230b5aa3"/><stop offset="1" stop-color="%23ff9933"/></linearGradient></defs><rect width="64" height="64" rx="12" fill="url(%23g)"/><circle cx="32" cy="32" r="16" fill="white" opacity=".9"/></svg>'
    />

    <!-- Fonts (MCGM-like) -->
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Noto+Sans+Devanagari:wght@400;500;700&display=swap" rel="stylesheet" />

    <!-- Styles -->
    <link rel="stylesheet" href="./styles.css" />

    <!-- Turf (spatial ops) -->
    <script src="https://cdn.jsdelivr.net/npm/@turf/turf@7.2.0/turf.min.js" defer></script>
    <!-- App -->
    <script src="./app.js" defer></script>
  </head>

  <body>
    <!-- HEADER (sticky) -->
    <div class="masthead">
      <div class="topbar">
        <div class="topbar-inner">
          <img src="https://www.mcgm.gov.in/com.mcgm.newframework/images/logo_V1.png" alt="BMC/MCGM" />
          <div>
            <div class="brand-title">Municipal Corporation of Greater Mumbai</div>
            <div class="brand-sub">Abandoned Vehicles – Identification &amp; Pre-Notice (Marshal Upload)</div>
          </div>
          <div class="header-actions">
            <button id="btnReset" class="btn-reset" type="button">Reset</button>
            <div class="partner-badge" title="Crescendo Innovative Solutions LLP">
              <img src="./data/Crescendo%20Logo.png" alt="Crescendo Innovative Solutions LLP" />
            </div>
          </div>
        </div>
      </div>

      <div class="progress-strip">
        <div class="progress-inner">
          <div class="milestones" aria-label="Processing stages">
            <div id="ms1" class="chip pending"><span class="ico"></span><span>Upload</span></div>
            <div id="ms2" class="chip pending"><span class="ico"></span><span>OCR</span></div>
            <div id="ms3" class="chip pending"><span class="ico"></span><span>Parse</span></div>
            <div id="ms4" class="chip pending"><span class="ico"></span><span>GeoJSON</span></div>
            <div id="ms5" class="chip pending"><span class="ico"></span><span>Review</span></div>
            <div id="ms6" class="chip pending"><span class="ico"></span><span>Redirect</span></div>
          </div>

          <div class="bar" role="progressbar" aria-valuemin="0" aria-valuemax="100">
            <div id="bar" class="bar-fill" style="width:0%"></div>
          </div>

          <div class="strip-row">
            <div id="status" class="status">Initializing…</div>
            <div id="redirectNote" class="status" style="display:none"></div>
            <div id="cdnPill" class="cdn-pill">CDN: checking…</div>
          </div>

          <div id="stageTimes" class="stage-times">
            Upload — 0.0s • OCR — 0.0s • Parse — 0.0s • GeoJSON — 0.0s • Review — 0.0s • Redirect — 0.0s
          </div>
        </div>
      </div>
    </div>

    <!-- BREADCRUMBS -->
    <div class="crumbs">
      <div class="crumbs-inner">
        <a href="https://www.mcgm.gov.in" target="_blank" rel="noopener">Home</a> › Abandoned Vehicles › Marshal Upload
      </div>
    </div>

    <!-- MAIN -->
    <div class="wrap">
      <div class="grid">
        <!-- LEFT: upload + previews -->
        <div class="col-image">
          <div id="dropCard" class="card">
            <div class="hdr"><div class="title">Upload Photo</div></div>
            <div class="body">
              <div id="drop" class="drop" role="button" tabindex="0" aria-label="Choose image">
                <!-- Single tap picker on mobile: label covers entire tile -->
                <label for="file" class="drop-inner">
                  <div class="dz-title">Tap to choose image</div>
                  <div class="dz-hint">or drag &amp; drop (JPG/PNG/HEIC from GPS Map Camera)</div>
                </label>
              </div>
              <input id="file" type="file" accept="image/*" hidden />
            </div>
          </div>

          <div id="originalCard" class="card" style="display:none">
            <div class="hdr"><div class="title">Original Photo (25%)</div></div>
            <div class="body">
              <div class="photo-surface">
                <img id="originalImg" class="preview-small" alt="original photo" />
              </div>
            </div>
          </div>

          <div id="overlayCard" class="card" style="display:none">
            <div class="hdr"><div class="title">Cropped Overlay (GPS text)</div></div>
            <div class="body">
              <div id="overlayWrap" class="photo-surface overlay-container">
                <img id="overlayImg" class="preview" alt="cropped overlay" />
                <div id="overlayScanner" class="overlay-scanner" aria-hidden="true"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- RIGHT: results -->
        <div class="col-results">
          <div class="card">
            <div class="hdr"><div class="title">Results</div></div>
            <div id="results" class="body" aria-live="polite" aria-atomic="true">
              <div id="resultsNote" class="results-note">Results will be populated post processing</div>
              <!-- key/value rows injected by app.js -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- FOOTER (sticky) -->
    <div class="footer">
      <div class="footer-inner">
        <div class="footer-row">
          <div class="footer-left">
            Developed by <strong>Crescendo Innovative Solutions LLP</strong> •
            Admin: <strong>Huzefa Fakhruddin</strong> —
            <a href="mailto:Care@crescendoits.com">Care@crescendoits.com</a>
          </div>
          <div class="footer-right">
            Build: <span id="appVersion">v2025.08.17.Prod.v4</span>
          </div>
        </div>
        <div class="footer-meta">
          &copy; 2025 Municipal Corporation of Greater Mumbai (MCGM) —
          <a href="https://www.mcgm.gov.in" target="_blank" rel="noopener">www.mcgm.gov.in</a>
        </div>
      </div>
    </div>

    <!-- GENERIC MODAL -->
    <div id="modalBackdrop" class="modal-backdrop" style="display:none" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modal">
        <div id="modalTitle" class="m-hdr">Notice</div>
        <div id="modalBody" class="m-body">Message goes here…</div>
        <div class="m-actions">
          <button id="modalCancel" class="btn" type="button">Cancel</button>
          <button id="modalReset" class="btn btn-danger" type="button">Reset Session</button>
        </div>
      </div>
    </div>

    <!-- TIMEOUT MODAL -->
    <div id="timeoutBackdrop" class="modal-backdrop" style="display:none" role="dialog" aria-modal="true" aria-labelledby="timeoutTitle">
      <div class="modal">
        <div id="timeoutTitle" class="m-hdr m-err">Stage Timed Out</div>
        <div id="timeoutBody" class="m-body">
          A stage exceeded the maximum allowed time.<br />
          <strong>Admin:</strong> Huzefa Fakhruddin —
          <a href="mailto:Care@crescendoits.com">Care@crescendoits.com</a>
        </div>
        <div class="m-actions">
          <button id="timeoutRetry" class="btn btn-primary" type="button">Retry</button>
          <button id="timeoutClose" class="btn" type="button">Close</button>
        </div>
      </div>
    </div>
  </body>
</html>
